{"ast":null,"code":"/**\n * Class representing users in PingOne Directory.\n *\n * This demo-specific class is developed and maintained by Ping Identity Technical Enablement.\n * Implements methods to integrate with PingOne via the management or authetnication APIs.\n * \n * This is a modified version of what comes with the live BXRetail app. This component was\n * stripped down to only what was necessary for the Terraform labs.\n *\n * @author Michael Sanchez, Technical Enablement\n */\n\nclass PingOneUsers {\n  /**\n   * Class constructor\n   * \n   * @param {object} Child object within the global window object that contains our env vars.\n  */\n  constructor(envVars) {\n    this.envId = envVars.REACT_APP_ENVID;\n    this.authPath = envVars.REACT_APP_AUTHPATH;\n    this.p1Host = envVars.REACT_APP_P1HOST;\n  }\n\n  /**\n   * Read User:\n   * Read one user's account data.\n   * \n   * @param {string} userId User Id, as GUID, of the user from which to read data.\n   * @param {string} token User bearer token.\n   * @return {object} Raw response object of user data from PingOne.\n   * {@link https://apidocs.pingidentity.com/pingone/platform/v1/api/#get-read-one-user}\n  */\n  async readUser(_ref) {\n    let {\n      userId,\n      token\n    } = _ref;\n    console.info('Integration.PingOneUsers.js', \"Reading user's data.\");\n\n    // Not best practice. Just doing it here because the demo is about Terraform deploying this app.\n    // appProxyHost = 'https://<k8s deploy name>-proxy.<k8s deploy domain>.com';\n    // E.g. appProxyHost = 'https://sko23-bxr-tf-proxy.ping-devops.com';\n\n    let domain = this.envVars.REACT_APP_HOST.split('.')[1];\n    let insertPosition = this.envVars.REACT_APP_HOST.indexOf(domain) - 1;\n    let appProxyHost = this.envVars.REACT_APP_HOST.slice(0, insertPosition) + '-proxy' + this.envVars.REACT_APP_HOST.slice(insertPosition);\n    console.log('appProxyHost', appProxyHost);\n    let myHeaders = new Headers();\n    myHeaders.append('Authorization', 'Bearer ' + token);\n    let requestOptions = {\n      method: 'GET',\n      headers: myHeaders,\n      redirect: 'manual'\n    };\n    // {{apiPath}}/environments/{{envID}}/users/{{userID}}?expand=population\n    const url = appProxyHost + '/user/' + this.envId + '/users/' + userId + '?expand=population';\n    const response = await fetch(url, requestOptions);\n    return response;\n  }\n\n  /**\n   * OIDC User Info endpoint\n   * Calls the OAuth user info endpoint at PingOne.\n   *\n   * @param {string} access_token User bearer token.\n   * {@link https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-userinfo}\n   */\n  async userInfo(access_token) {\n    console.info('Integration.PingOneUsers', 'Calling the User Info endpoint.');\n    let myHeaders = new Headers();\n    myHeaders.append('Authorization', 'Bearer ' + access_token);\n    const requestOptions = {\n      method: 'POST',\n      headers: myHeaders,\n      redirect: 'manual'\n    };\n    const url = this.p1Host + '/' + this.envId + '/as/userinfo';\n    const rawResponse = await fetch(url, requestOptions);\n    return rawResponse;\n  }\n}\nexport default PingOneUsers;","map":{"version":3,"names":["PingOneUsers","constructor","envVars","envId","REACT_APP_ENVID","authPath","REACT_APP_AUTHPATH","p1Host","REACT_APP_P1HOST","readUser","userId","token","console","info","domain","REACT_APP_HOST","split","insertPosition","indexOf","appProxyHost","slice","log","myHeaders","Headers","append","requestOptions","method","headers","redirect","url","response","fetch","userInfo","access_token","rawResponse"],"sources":["/Users/michaelsanchez/projects/TechnicalEnablement/vscode-workspaces/BXRetail/BXRetail-Apps/bxretail/src/components/Integration/PingOneUsers.js"],"sourcesContent":["/**\n * Class representing users in PingOne Directory.\n *\n * This demo-specific class is developed and maintained by Ping Identity Technical Enablement.\n * Implements methods to integrate with PingOne via the management or authetnication APIs.\n * \n * This is a modified version of what comes with the live BXRetail app. This component was\n * stripped down to only what was necessary for the Terraform labs.\n *\n * @author Michael Sanchez, Technical Enablement\n */\n\nclass PingOneUsers {\n    /**\n     * Class constructor\n     * \n     * @param {object} Child object within the global window object that contains our env vars.\n    */\n    constructor(envVars) {\n        this.envId = envVars.REACT_APP_ENVID;\n        this.authPath = envVars.REACT_APP_AUTHPATH;\n        this.p1Host = envVars.REACT_APP_P1HOST;\n    }\n\n    /**\n     * Read User:\n     * Read one user's account data.\n     * \n     * @param {string} userId User Id, as GUID, of the user from which to read data.\n     * @param {string} token User bearer token.\n     * @return {object} Raw response object of user data from PingOne.\n     * {@link https://apidocs.pingidentity.com/pingone/platform/v1/api/#get-read-one-user}\n    */\n    async readUser({ userId, token }) {\n        console.info('Integration.PingOneUsers.js', \"Reading user's data.\");\n\n        // Not best practice. Just doing it here because the demo is about Terraform deploying this app.\n        // appProxyHost = 'https://<k8s deploy name>-proxy.<k8s deploy domain>.com';\n        // E.g. appProxyHost = 'https://sko23-bxr-tf-proxy.ping-devops.com';\n\n        let domain = this.envVars.REACT_APP_HOST.split('.')[1];\n        let insertPosition = this.envVars.REACT_APP_HOST.indexOf(domain) - 1;\n        let appProxyHost = this.envVars.REACT_APP_HOST.slice(0, insertPosition) + '-proxy' + this.envVars.REACT_APP_HOST.slice(insertPosition);\n        console.log('appProxyHost', appProxyHost);\n        \n\n      \n        let myHeaders = new Headers();\n        myHeaders.append('Authorization', 'Bearer ' + token);\n        \n        let requestOptions = {\n            method: 'GET',\n            headers: myHeaders,\n            redirect: 'manual',\n        };\n        // {{apiPath}}/environments/{{envID}}/users/{{userID}}?expand=population\n        const url = appProxyHost + '/user/' + this.envId + '/users/' + userId + '?expand=population';\n        const response = await fetch(url, requestOptions);\n\n        return response;\n    }\n\n    /**\n     * OIDC User Info endpoint\n     * Calls the OAuth user info endpoint at PingOne.\n     *\n     * @param {string} access_token User bearer token.\n     * {@link https://apidocs.pingidentity.com/pingone/platform/v1/api/#post-userinfo}\n     */\n    async userInfo(access_token) {\n        console.info('Integration.PingOneUsers', 'Calling the User Info endpoint.');\n\n        let myHeaders = new Headers();\n        myHeaders.append('Authorization', 'Bearer ' + access_token);\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            redirect: 'manual',\n        };\n\n        const url = this.p1Host + '/' + this.envId + '/as/userinfo';\n        const rawResponse = await fetch(url, requestOptions);\n\n        return rawResponse;\n    }\n}\nexport default PingOneUsers;\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,YAAY,CAAC;EACf;AACJ;AACA;AACA;AACA;EACIC,WAAW,CAACC,OAAO,EAAE;IACjB,IAAI,CAACC,KAAK,GAAGD,OAAO,CAACE,eAAe;IACpC,IAAI,CAACC,QAAQ,GAAGH,OAAO,CAACI,kBAAkB;IAC1C,IAAI,CAACC,MAAM,GAAGL,OAAO,CAACM,gBAAgB;EAC1C;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACI,MAAMC,QAAQ,OAAoB;IAAA,IAAnB;MAAEC,MAAM;MAAEC;IAAM,CAAC;IAC5BC,OAAO,CAACC,IAAI,CAAC,6BAA6B,EAAE,sBAAsB,CAAC;;IAEnE;IACA;IACA;;IAEA,IAAIC,MAAM,GAAG,IAAI,CAACZ,OAAO,CAACa,cAAc,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;IACtD,IAAIC,cAAc,GAAG,IAAI,CAACf,OAAO,CAACa,cAAc,CAACG,OAAO,CAACJ,MAAM,CAAC,GAAG,CAAC;IACpE,IAAIK,YAAY,GAAG,IAAI,CAACjB,OAAO,CAACa,cAAc,CAACK,KAAK,CAAC,CAAC,EAAEH,cAAc,CAAC,GAAG,QAAQ,GAAG,IAAI,CAACf,OAAO,CAACa,cAAc,CAACK,KAAK,CAACH,cAAc,CAAC;IACtIL,OAAO,CAACS,GAAG,CAAC,cAAc,EAAEF,YAAY,CAAC;IAIzC,IAAIG,SAAS,GAAG,IAAIC,OAAO,EAAE;IAC7BD,SAAS,CAACE,MAAM,CAAC,eAAe,EAAE,SAAS,GAAGb,KAAK,CAAC;IAEpD,IAAIc,cAAc,GAAG;MACjBC,MAAM,EAAE,KAAK;MACbC,OAAO,EAAEL,SAAS;MAClBM,QAAQ,EAAE;IACd,CAAC;IACD;IACA,MAAMC,GAAG,GAAGV,YAAY,GAAG,QAAQ,GAAG,IAAI,CAAChB,KAAK,GAAG,SAAS,GAAGO,MAAM,GAAG,oBAAoB;IAC5F,MAAMoB,QAAQ,GAAG,MAAMC,KAAK,CAACF,GAAG,EAAEJ,cAAc,CAAC;IAEjD,OAAOK,QAAQ;EACnB;;EAEA;AACJ;AACA;AACA;AACA;AACA;AACA;EACI,MAAME,QAAQ,CAACC,YAAY,EAAE;IACzBrB,OAAO,CAACC,IAAI,CAAC,0BAA0B,EAAE,iCAAiC,CAAC;IAE3E,IAAIS,SAAS,GAAG,IAAIC,OAAO,EAAE;IAC7BD,SAAS,CAACE,MAAM,CAAC,eAAe,EAAE,SAAS,GAAGS,YAAY,CAAC;IAE3D,MAAMR,cAAc,GAAG;MACnBC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAEL,SAAS;MAClBM,QAAQ,EAAE;IACd,CAAC;IAED,MAAMC,GAAG,GAAG,IAAI,CAACtB,MAAM,GAAG,GAAG,GAAG,IAAI,CAACJ,KAAK,GAAG,cAAc;IAC3D,MAAM+B,WAAW,GAAG,MAAMH,KAAK,CAACF,GAAG,EAAEJ,cAAc,CAAC;IAEpD,OAAOS,WAAW;EACtB;AACJ;AACA,eAAelC,YAAY"},"metadata":{},"sourceType":"module","externalDependencies":[]}