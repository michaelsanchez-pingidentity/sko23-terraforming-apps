{"ast":null,"code":"/**\nClass representing PingOne Authorization API's integration.\nThis demo-specific class is developed and maintained by Ping Identity Technical Enablement.\nImplements methods to integrate with PingOne authentication-related API endpoints.\n\n@author Michael Sanchez\n@see https://apidocs.pingidentity.com/pingone/platform/v1/api/#authentication-apis\n*/\nimport OAuthUtils from '../Utils/OAuthUtils';\nimport Session from \"../Utils/Session\";\nclass PingOneAuthZ {\n  /**\n  Class constructor\n   * @param {string} authPath PingOne auth path for your regions tenant. (For BXR, could be the DG (PAZ) proxy host.)\n   * @param {string} envId PingOne environment ID needed for authZ integrations. \n   */\n  constructor(authPath, envId) {\n    this.authzEndpoint = '/as/authorize';\n    this.tokenEndpoint = '/as/token';\n    this.authPath = authPath;\n    this.envId = envId;\n    this.OAuthUtils = new OAuthUtils();\n    this.Session = new Session();\n    this.envVars = window._env_;\n  }\n\n  /**\n  Authorization Flow:\n  Start an authorization flow.\n  \n  @see https://apidocs.pingidentity.com/pingone/platform/v1/api/#openid-connectoauth-2\n  @param {string} responseType The OAuth grant type. Options are \"code\" and \"token\".\n  @param {string} clientId The client ID of the OAuth application.\n  @param {string} redirectURI The URL to which the OAuth AS should redirect the user with a flowId.\n  @param {string} scopes The OAuth scopes needed for the given for which the user is being authorized.\n  @return {string} The flowId extracted from the 302 redirect URL.\n  */\n  async authorize(_ref) {\n    let {\n      responseType,\n      clientId,\n      redirectURI,\n      scopes,\n      lowPriv\n    } = _ref;\n    console.info('Integration.PingOneAuthZ.js', 'Sending user to the authorize endpoint to start an authN flow and get a flowId.');\n    let url = this.envVars.REACT_APP_P1HOST + '/' + this.envVars.REACT_APP_ENVID + '/as/authorize?response_type=' + responseType + '&client_id=' + clientId + '&redirect_uri=' + redirectURI + '&scope=' + scopes;\n\n    // Add pkce support for auth code grant types\n    if (responseType === 'code') {\n      const state = this.OAuthUtils.getRandomString(20);\n      const code_verifier = this.OAuthUtils.getRandomString(128);\n      let code_challenge;\n      try {\n        code_challenge = await this.OAuthUtils.generateCodeChallenge(code_verifier);\n      } catch (e) {\n        console.error('Integration.PingOneAuthZ.js', 'Error generating code challenge', e);\n        throw new Error('Integration.PingOneAuthZ.js', 'Unexpected exception in generateCodeChallenge().');\n      }\n\n      // Save pkce code_verifier and state values\n      this.Session.setAuthenticatedUserItem('state', state, 'session');\n      this.Session.setAuthenticatedUserItem('code_verifier', code_verifier, 'session');\n      url += '&state=' + state + '&code_challenge=' + code_challenge + '&code_challenge_method=S256';\n    }\n    window.location.assign(url);\n  }\n\n  /**\n  OAuth Token:\n  Swaps an OAuth code for an OAuth access token.\n   @param {string} code Authorization code from AS.\n  @param {string} redirectURI App URL user should be redirected to after swap for token.\n  @returns {object} JSON formatted response object.\n  */\n  async getToken(_ref2) {\n    let {\n      code,\n      redirectURI,\n      swaprods,\n      clientId\n    } = _ref2;\n    console.info('Integration.PingOneAuthZ.js', 'Swapping an authorization code for an access token.');\n    let myHeaders = new Headers();\n    // myHeaders.append('Authorization', 'Basic ' + swaprods);\n    myHeaders.append('Content-Type', 'application/x-www-form-urlencoded');\n    let urlencoded = new URLSearchParams();\n    urlencoded.append('grant_type', 'authorization_code'); // Grant type should ideally be a param passed in. But in the demos we're only doing auth code.\n    urlencoded.append('code', code);\n    urlencoded.append('redirect_uri', redirectURI);\n    urlencoded.append('client_id', clientId);\n    urlencoded.append('code_verifier', this.Session.getAuthenticatedUserItem('code_verifier', 'session'));\n    const requestOptions = {\n      method: 'POST',\n      headers: myHeaders,\n      body: urlencoded,\n      redirect: 'manual'\n    };\n    const url = this.authPath + '/auth/' + this.envVars.REACT_APP_ENVID + '/as/token';\n    const response = await fetch(url, requestOptions);\n    const jsonResponse = await response.json();\n    return jsonResponse;\n  }\n\n  /**\n  Swap Code for Token (BXFinance PingFederate - OpenBanking):\n  Swaps an OAuth code for an OAuth access token.\n   @see https://docs.pingidentity.com/bundle/pingfederate-110/page/xhx1564003025004.html\n  @param {string} code Authorization code from AS.\n  @param {string} bxfHost BXF base url\n  @param {string} appHost REACT_APP_HOST\n  @return {string} JSON web token.\n  */\n\n  async swapCodeForToken(code, bxfHost, appHost) {\n    console.info('Integration.PingOneAuthZ.js', 'Swapping authorization code for access token');\n    let myHeaders = new Headers();\n    myHeaders.append('Authorization', 'Basic T0ItUEFSOmFDNm5IelN2ODZwU0lmalNUZG5wZXBUbDhUOFZ3SWVLa2FiRkgwVEpaa2NNU09lVXBuazUwUXlIeTNTdmVueHc=');\n    myHeaders.append('Content-Type', 'application/x-www-form-urlencoded');\n    const requestOptions = {\n      method: 'POST',\n      headers: myHeaders\n    };\n    const url = bxfHost + '/as/token.oauth2?grant_type=authorization_code&redirect_uri=' + appHost + '/app/shop/checkout&code=' + code;\n    const response = await fetch(url, requestOptions);\n    const jsonResponse = await response.json();\n    return jsonResponse;\n  }\n}\nexport default PingOneAuthZ;","map":{"version":3,"names":["OAuthUtils","Session","PingOneAuthZ","constructor","authPath","envId","authzEndpoint","tokenEndpoint","envVars","window","_env_","authorize","responseType","clientId","redirectURI","scopes","lowPriv","console","info","url","REACT_APP_P1HOST","REACT_APP_ENVID","state","getRandomString","code_verifier","code_challenge","generateCodeChallenge","e","error","Error","setAuthenticatedUserItem","location","assign","getToken","code","swaprods","myHeaders","Headers","append","urlencoded","URLSearchParams","getAuthenticatedUserItem","requestOptions","method","headers","body","redirect","response","fetch","jsonResponse","json","swapCodeForToken","bxfHost","appHost"],"sources":["/Users/michaelsanchez/projects/TechnicalEnablement/vscode-workspaces/BXRetail/BXRetail-Apps/bxretail/src/components/Integration/PingOneAuthZ.js"],"sourcesContent":["/**\nClass representing PingOne Authorization API's integration.\nThis demo-specific class is developed and maintained by Ping Identity Technical Enablement.\nImplements methods to integrate with PingOne authentication-related API endpoints.\n\n@author Michael Sanchez\n@see https://apidocs.pingidentity.com/pingone/platform/v1/api/#authentication-apis\n*/\nimport OAuthUtils from '../Utils/OAuthUtils';\nimport Session from \"../Utils/Session\";\n\nclass PingOneAuthZ {\n    authzEndpoint = '/as/authorize';\n    tokenEndpoint = '/as/token';\n\n    /**\n    Class constructor\n     * @param {string} authPath PingOne auth path for your regions tenant. (For BXR, could be the DG (PAZ) proxy host.)\n     * @param {string} envId PingOne environment ID needed for authZ integrations. \n     */\n    constructor(authPath, envId) {\n        this.authPath = authPath;\n        this.envId = envId;\n        this.OAuthUtils = new OAuthUtils();\n        this.Session = new Session();\n        this.envVars = window._env_;\n    }\n\n    /**\n    Authorization Flow:\n    Start an authorization flow.\n    \n    @see https://apidocs.pingidentity.com/pingone/platform/v1/api/#openid-connectoauth-2\n    @param {string} responseType The OAuth grant type. Options are \"code\" and \"token\".\n    @param {string} clientId The client ID of the OAuth application.\n    @param {string} redirectURI The URL to which the OAuth AS should redirect the user with a flowId.\n    @param {string} scopes The OAuth scopes needed for the given for which the user is being authorized.\n    @return {string} The flowId extracted from the 302 redirect URL.\n    */\n    async authorize({ responseType, clientId, redirectURI, scopes, lowPriv }) {\n        console.info(\n            'Integration.PingOneAuthZ.js',\n            'Sending user to the authorize endpoint to start an authN flow and get a flowId.'\n        );\n\n        let url = this.envVars.REACT_APP_P1HOST + '/' + this.envVars.REACT_APP_ENVID + '/as/authorize?response_type=' + responseType + '&client_id=' + clientId + '&redirect_uri=' + redirectURI + '&scope=' + scopes;\n\n        // Add pkce support for auth code grant types\n        if (responseType === 'code') {\n            const state = this.OAuthUtils.getRandomString(20);\n            const code_verifier = this.OAuthUtils.getRandomString(128);\n            let code_challenge;\n\n            try {\n                code_challenge = await this.OAuthUtils.generateCodeChallenge(code_verifier);\n            } catch (e) {\n                console.error('Integration.PingOneAuthZ.js', 'Error generating code challenge', e);\n                throw new Error('Integration.PingOneAuthZ.js', 'Unexpected exception in generateCodeChallenge().');\n            }\n\n            // Save pkce code_verifier and state values\n            this.Session.setAuthenticatedUserItem('state', state, 'session');\n            this.Session.setAuthenticatedUserItem('code_verifier', code_verifier, 'session');\n\n            url += '&state=' + state + '&code_challenge=' + code_challenge + '&code_challenge_method=S256';\n        }\n\n        window.location.assign(url);\n    }\n\n    /**\n    OAuth Token:\n    Swaps an OAuth code for an OAuth access token.\n\n    @param {string} code Authorization code from AS.\n    @param {string} redirectURI App URL user should be redirected to after swap for token.\n    @returns {object} JSON formatted response object.\n    */\n    async getToken({ code, redirectURI, swaprods, clientId }) {\n        console.info('Integration.PingOneAuthZ.js', 'Swapping an authorization code for an access token.');\n\n        let myHeaders = new Headers();\n        // myHeaders.append('Authorization', 'Basic ' + swaprods);\n        myHeaders.append('Content-Type', 'application/x-www-form-urlencoded');\n\n        let urlencoded = new URLSearchParams();\n        urlencoded.append('grant_type', 'authorization_code'); // Grant type should ideally be a param passed in. But in the demos we're only doing auth code.\n        urlencoded.append('code', code);\n        urlencoded.append('redirect_uri', redirectURI);\n        urlencoded.append('client_id', clientId);\n        urlencoded.append('code_verifier', this.Session.getAuthenticatedUserItem('code_verifier', 'session'));\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: urlencoded,\n            redirect: 'manual',\n        };\n        const url = this.authPath + '/auth/' + this.envVars.REACT_APP_ENVID + '/as/token';\n        const response = await fetch(url, requestOptions);\n        const jsonResponse = await response.json();\n        return jsonResponse;\n    }\n\n    /**\n    Swap Code for Token (BXFinance PingFederate - OpenBanking):\n    Swaps an OAuth code for an OAuth access token.\n\n    @see https://docs.pingidentity.com/bundle/pingfederate-110/page/xhx1564003025004.html\n    @param {string} code Authorization code from AS.\n    @param {string} bxfHost BXF base url\n    @param {string} appHost REACT_APP_HOST\n    @return {string} JSON web token.\n    */\n\n    async swapCodeForToken(code, bxfHost, appHost) {\n        console.info('Integration.PingOneAuthZ.js', 'Swapping authorization code for access token');\n\n        let myHeaders = new Headers();\n        myHeaders.append('Authorization', 'Basic T0ItUEFSOmFDNm5IelN2ODZwU0lmalNUZG5wZXBUbDhUOFZ3SWVLa2FiRkgwVEpaa2NNU09lVXBuazUwUXlIeTNTdmVueHc=');\n        myHeaders.append('Content-Type', 'application/x-www-form-urlencoded');\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n        };\n\n        const url = bxfHost + '/as/token.oauth2?grant_type=authorization_code&redirect_uri=' + appHost + '/app/shop/checkout&code=' + code;\n        const response = await fetch(url, requestOptions);\n        const jsonResponse = await response.json();\n        return jsonResponse;\n    }\n} export default PingOneAuthZ;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}